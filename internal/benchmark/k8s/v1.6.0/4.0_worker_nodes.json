{
  "benchmark_type": "k8s",
  "categories": [
    {
      "name": "Control Plane Components",
      "sub_category": {
        "name": "Worker Nodes",
        "audit_tests": [
          {
            "name": "4.1.1 Ensure that the kubelet service file permissions are set to 644 or more restrictive",
            "description": "Ensure that the kubelet service file has permissions of 644 or more restrictive.",
            "profile_applicability": "Level 1 - Master Node",
            "audit": [
              "export kubelet_service_config=/etc/systemd/system/kubelet.service.d/10- kubeadm.conf",
              "stat -c %a /etc/systemd/system/kubelet.service.d/10-kubeadm.conf"
            ],
            "remediation": "Run the below command (based on the file location on your system) on the each worker node. For example,\nchmod 755 /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\n",
            "check_type": "multi_param",
            "impact": "None",
            "eval_expr": "$1 <= 644;",
            "default_value": "By default, the kubelet service file has permissions of 640.",
            "references": [
              "https://kubernetes.io/docs/admin/kubelet/",
              "https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#44-joining-your-nodes",
              "https://kubernetes.io/docs/admin/kubeadm/#kubelet-drop-in"
            ]
          },
          {
            "name": "4.1.2 Ensure that the kubelet service file ownership is set to root:root",
            "description": "Ensure that the kubelet service file ownership is set to root:root.",
            "profile_applicability": "Level 1 - Master Node",
            "audit": [
              "export kubelet_service_config=/etc/systemd/system/kubelet.service.d/10- kubeadm.conf",
              "stat -c %a /etc/systemd/system/kubelet.service.d/10-kubeadm.conf"
            ],
            "remediation": "Run the below command (based on the file location on your system) on the each worker node. For example,\nchown root:root /etc/systemd/system/kubelet.service.d/10-kubeadm.conf",
            "check_type": "multi_param",
            "impact": "None",
            "eval_expr": "$1 == 'root:root';",
            "default_value": "By default, kubelet service file ownership is set to root:root.",
            "references": [
              "https://kubernetes.io/docs/admin/kubelet/",
              "https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/#44-joining-your-nodes",
              "https://kubernetes.io/docs/admin/kubeadm/#kubelet-drop-in"
            ]
          },
          {
            "name": "4.1.3 If proxy kubeconfig file exists ensure permissions are set to 644 or more restrictive",
            "description": "If kube-proxy is running, and if it is using a file-based kubeconfig file, ensure that the proxy kubeconfig file has permissions of 644 or more restrictive.",
            "profile_applicability": "Level 1 - Master Node",
            "audit": [
              "ps -ef | grep kube-proxy |grep 'kubeconfig' | grep -o 'kubeconfig=[^\"]\\S*' | awk -F \"=\" '{print $2}' |awk 'FNR <= 1'",
              "stat -c %a #0"
            ],
            "remediation": "Remediation:\nRun the below command (based on the file location on your system) on the each worker node. For example,\nchmod 644 <proxy kubeconfig file>",
            "check_type": "multi_param",
            "impact": "None",
            "eval_expr": "$1 <= 644;",
            "default_value": "By default, proxy file has permissions of 640.",
            "references": [
              "https://kubernetes.io/docs/admin/kube-proxy/"
            ]
          }
        ]
      }
    }
  ]
}