{
  "benchmark_type": "k8s",
  "categories": [
    {
      "name": "Control Plane Components",
      "sub_category": {
        "name": "API Server",
        "audit_tests": [
          {
            "name": "1.2.35 Ensure that the API Server only makes use of Strong Cryptographic Ciphers",
            "description": "Ensure that the API server is configured to only use strong cryptographic ciphers.",
            "profile_applicability": "Level 1 - Master Node",
            "audit": [
              "ps -ef | grep kube-apiserver |grep 'tls-cipher-suites' | grep -o 'tls-cipher-suites=[^\"]\\S*' | awk -F \"=\" '{print $2}' |awk 'FNR <= 1'",
              "sudo awk -v FS=\"tls-cipher-suites=\" 'NF>1{print $2}'  /etc/kubernetes/manifests/kube-apiserver.yaml"
            ],
            "remediation": "Follow the Kubernetes documentation and configure a EncryptionConfig file. In this file, choose aescbc, kms or secretbox as the encryption provider.",
            "check_type": "multi_param",
            "impact": "API server clients that cannot support modern cryptographic ciphers will not be able to make connections to the API server.",
            "eval_expr": "'$0' == 'TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM _SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_RSA_WITH_AES_256_GCM _SHA384,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305,TLS_ECDHE_ECDSA_WITH_AES_256_GCM _SHA384'; && '$0' == '$1';",
            "default_value": "By default the Kubernetes API server supports a wide range of TLS ciphers",
            "references": [
              "https://github.com/ssllabs/research/wiki/SSL-and-TLS-Deployment-Best- Practices#23-use-secure-cipher-suites"
            ]
          }
        ]
      }
    }
  ]
}